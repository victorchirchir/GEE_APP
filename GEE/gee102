/**** Start of imports. If edited, may not auto-convert in the playground. ****/
var L8 = ee.ImageCollection("LANDSAT/LC08/C01/T1_TOA"),
    point = 
    /* color: #d63000 */
    /* shown: false */
    ee.Geometry.Point([36.81941485927218, -1.2983171014235197]),
    vegetation = 
    /* color: #98ff00 */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[36.74381438460237, -1.3253713626419827],
          [36.745788490437334, -1.3260578243529688],
          [36.74793425764925, -1.3258004012336542],
          [36.75162497725374, -1.325542978087572],
          [36.754028236531084, -1.324684900740723],
          [36.75771895613558, -1.3245990929896978],
          [36.75960723128206, -1.3232261685691968],
          [36.75969306197054, -1.3214242041141973],
          [36.76106635298616, -1.3219390512348197],
          [36.763984596394366, -1.320909356886861],
          [36.76595870222933, -1.3205661253427143],
          [36.766731178425616, -1.319536430425907],
          [36.76793280806429, -1.318420927118363],
          [36.769992744587725, -1.3185067350828417],
          [36.773254310749834, -1.316189919004178],
          [36.771709358357256, -1.3135298682597039],
          [36.76939192976839, -1.312671786770055],
          [36.766731178425616, -1.3103549652776418],
          [36.76484290327913, -1.3112988557741772],
          [36.76235381331331, -1.3132724438437406],
          [36.758748924397295, -1.3135298682597039],
          [36.75686064925081, -1.3141305251271496],
          [36.75282660689241, -1.3149027980301649],
          [36.75282660689241, -1.3187641589585557],
          [36.756259834431475, -1.3203087016534825],
          [36.75385657515413, -1.3216816276878478],
          [36.748535072468584, -1.3212525883836048],
          [36.74398604597933, -1.3200512779376103],
          [36.742526924275225, -1.3244274774787161]]]),
    bare = 
    /* color: #81828b */
    /* shown: false */
    ee.Geometry.Polygon(
        [[[36.921057766084864, -1.3307498759013412],
          [36.92133671582241, -1.3321442480162298],
          [36.922280853395655, -1.3323373148622655],
          [36.92234522641201, -1.3326161891687254],
          [36.921787326936915, -1.3332168414138457],
          [36.92232376873989, -1.3338389453703556],
          [36.92411548436184, -1.3346755676845652],
          [36.92535433249172, -1.3340075278012922],
          [36.92692074255642, -1.333149453396151],
          [36.928508610293235, -1.3316263705906344],
          [36.92814382986721, -1.3313045924126692],
          [36.927543015047874, -1.3288161730856396],
          [36.92565473990139, -1.3274647029175881],
          [36.92413124518093, -1.3277650296854637],
          [36.92260775046047, -1.3286016540606982],
          [36.92192110495266, -1.3297600565740262]]]),
    water = 
    /* color: #2970ff */
    /* shown: false */
    ee.Geometry.MultiPolygon(
        [[[[36.7945939645465, -1.175542718096625],
           [36.79534498307067, -1.1757357964936082],
           [36.7961603746112, -1.176014687487917],
           [36.79676118943053, -1.1759288748772458],
           [36.79766241165954, -1.176057593792254],
           [36.79766241165954, -1.1754569054714505],
           [36.79731908890563, -1.1754783586279953],
           [36.7960530862506, -1.1754354523147528],
           [36.795452271431266, -1.1750707486255518],
           [36.79493728730041, -1.1745344195843512],
           [36.79487291428405, -1.174984935985874],
           [36.79443303200561, -1.1749527562453252],
           [36.79411116692382, -1.1752316473178377],
           [36.793971692055045, -1.175778702802245]]],
         [[[36.367612746574395, -0.8116393836857488],
           [36.392331984855645, -0.7814299012180098],
           [36.386838820793145, -0.7580860609857037],
           [36.42460432372283, -0.7519067879351937],
           [36.414304641105645, -0.7340555058025005],
           [36.35456648192596, -0.726503018732622],
           [36.31611433348846, -0.7251298379052425],
           [36.290708449699395, -0.753966546594046],
           [36.32572737059783, -0.7807433195143645],
           [36.309934523918145, -0.8068333445334555],
           [36.33019056639861, -0.8161021292140989]]]]);
/***** End of imports. If edited, may not auto-convert in the playground. *****/
var bands=['B2','B3','B4','B5','B6','B7'];
var image=ee.Image(L8.filterBounds(point)
.sort('CLOUD_COVER').first()).select(bands);
print (image);
Map.addLayer(image,{min:0,max:0.7,bands:['B4','B3','B2']},'true colour');
var bareMean=image.reduceRegion({reducer:ee.Reducer.mean(),
geometry:bare,
scale:30}).values();
// print(bareMean);
var vegMean=image.reduceRegion({reducer:ee.Reducer.mean(),
geometry:vegetation,
scale:30}).values();
// print(vegMean);
var waterMean=image.reduceRegion({reducer:ee.Reducer.mean(),
geometry:water,
scale:30}).values();
// print(waterMean);
var chart=ui.Chart.image.regions(image,ee.FeatureCollection([
  ee.Feature(bare,{label:'bare'}),
  ee.Feature(vegetation,{label:'vegetation'}),
  ee.Feature(water,{label:'water'})]),
  ee.Reducer.mean(),30,'label',[0.48,0.56,0.65,0.86,1.61,2.2]
  );
  print (chart);
  var endmembers=ee.Array.cat([bareMean,vegMean,waterMean],1);
  print(endmembers);
  var imageArray=image.toArray().toArray(1);
  var unmixed=ee.Image(endmembers).matrixSolve(imageArray);
  var unmixedImage=unmixed.arrayProject([0])
                          .arrayFlatten([['bare','veg','water']]);
Map.addLayer(unmixedImage,{},'fractions');
